<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Google Maps - jQuery Mobile Demos</title>

		<!-- Include jQuery Mobile stylesheets -->
		  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="main.css">

		<link href='http://fonts.googleapis.com/css?family=Oswald:400,700,300' rel='stylesheet' type='text/css'>

		<!-- Include the jQuery library -->
		<script src="js/jquery-1.11.3.min.js"></script>
		<!-- Include the jQuery Mobile library -->
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>

<script>
		/*
	 * Google Maps documentation: http://code.google.com/apis/maps/documentation/javascript/basics.html
	 * Geolocation documentation: http://dev.w3.org/geo/api/spec-source.html
	 */

	var map;
	var infowindow;

	function initialize() {

	  var pyrmont = new google.maps.LatLng(-33.8665433, 151.1956316);

	  map = new google.maps.Map(document.getElementById('map-canvas'), {
	    center: pyrmont,
	    zoom: 15
	  });

	  var request = {
	    location: pyrmont,
	    radius: 500,
	    types: ['food']
	  };

	  infowindow = new google.maps.InfoWindow();
	  var service = new google.maps.places.PlacesService(map);
	  service.nearbySearch(request, callback);
	}

	function callback(results, status) {
	  if (status == google.maps.places.PlacesServiceStatus.OK) {
	    for (var i = 0; i < results.length; i++) {
	      createMarker(results[i]);
	    }
	  }
	}

	function createMarker(place) {
	  var placeLoc = place.geometry.location;
	  var marker = new google.maps.Marker({
	    map: map,
	    position: place.geometry.location
	  });

	  google.maps.event.addListener(marker, 'click', function() {
	    infowindow.setContent(place.name);
	    infowindow.open(map, this);
	  });

	}

	google.maps.event.addDomListener(window, 'load', initialize);

	var count=30;

	var counter=setInterval(timer, 1000); //1000 will  run it every 1 second

	function timer() {

		count=count-1;
		console.log(count);
		if (count == 20) {
			$("#imageChange").attr("src", "images/yeti-content.png");
			console.log("change!");
		} else if ( count == 10){
			$("#imageChange").attr("src", "images/yeti-mad.png");
		} else if (count <= 0) {
			$("#imageChange").attr("src", "images/yeti-hungry.png");
			$("#imageChange").attr("width", "300px");
			$('#header').css("height", "100vh");
			$("#countdown").css("display", "none");
			$("#map-canvas").css("display", "none");

			var audioElement = document.createElement('audio');
			audioElement.setAttribute('src', 'bear.wav');
			audioElement.play();

			clearInterval(counter);
			return;
		}

			document.getElementById("countdown").innerHTML=count + " secs"; // watch for spelling
	}

      $(document).on('swipeleft swiperight', function (event) {
       if(event.type == 'swiperight') {
        var prevpage = '#' + $.mobile.activePage.prev('div[data-role="page"]')[0].id;
        $.mobile.changePage(prevpage, {
         transition: 'slide',
         reverse: true
        });
       }

       if(event.type == 'swipeleft') {
        var nextpage = '#' + $.mobile.activePage.next('div[data-role="page"]')[0].id;
        $.mobile.changePage(nextpage, {
         transition: 'slide',
         reverse: false
        });
       }
      });


</script>

	</head>
	<body>

		<div data-role="page" id="pageone">

		    <div data-role="main" class="ui-content">
		    	<img src="images/yeti-content.png" width="300px">
		    	<h1>HUNGRY YETI</h1>
		    	<p>Pick a place to eat before the yeti picks one for you! </p>
		    	<a href="#map-page" data-transition="slide" data-role="button">START!</a>
		    </div>
		</div> 

		<div data-role="page" id="map-page" data-url="map-page">
		    <div  id = "header" data-role="header" data-theme="a">
		    	<div id= "imageContainer">
			   		<img id="imageChange" src="images/yeti-happy.png" width="150px">
			   	</div>
			    <h1 id = "countdown"></h1>
		    </div>
		    <div role="main" class="ui-content" id="map-canvas">
		     <!-- map loads here... -->
		    </div>
		</div>

	</body>
</html>