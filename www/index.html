<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Google Maps - jQuery Mobile Demos</title>

		<link rel="stylesheet" href="main.css">

		<link href='http://fonts.googleapis.com/css?family=Oswald:400,700,300' rel='stylesheet' type='text/css'>

		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

		<script>
		// Bind to "mobileinit" before you load jquery.mobile.js
		// Set the default transition to slide
		$(document).on( "mobileinit", function() {
			$.mobile.defaultPageTransition = "slide";
		});	
		</script>

		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

		<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>

<script>

$(function() {
	$("#start").click( function() {
		location.reload();
	});
});

var map;
var infowindow;
var resultsArray;

function initialize() {

  var sheridan = new google.maps.LatLng(43.468871, -79.699926);

  map = new google.maps.Map(document.getElementById('map-canvas'), {
    center: sheridan,
    zoom: 15
  });

  var posInfo = new google.maps.InfoWindow({
	map: map,
	content: 'YOU!'
  });

  var posMarker = new google.maps.Marker({
	map: map,
	position: sheridan,
   });

  posInfo.open(map, posMarker);

  var request = {
    location: sheridan,
    radius: 2000,
    types: ['food']
  };

  infowindow = new google.maps.InfoWindow();
  var service = new google.maps.places.PlacesService(map);
  service.nearbySearch(request, callback);
}

function callback(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    for (var i = 0; i < results.length; i++) {
      resultsArray.push(results[i]);
    }
  }
}

var counter = 0;
var minuser = counter-1;
var resultsArray = [];

$(function() {
	$("#next").click( function() {
             counter += 1;
             createMarker(resultsArray[counter]);
             resultsArray[minuser].setMap(null);
             map.panTo(marker.position);
             map.setZoom(17);
             map.setCenter(marker.position);
    });
});

function createMarker(place) {
  var placeLoc = place.geometry.location;
  var marker = new google.maps.Marker({
    map: map,
    position: place.geometry.location
  });

  	infowindow.setContent(place.name);
    infowindow.open(map, marker);
}

google.maps.event.addDomListener(window, 'load', initialize);

///END OF GOOGLE MAPS!

//google.maps.event.addListenerOnce(map, 'idle', function(){
  //  console.log("READY!");
//});


/////////////TIMER!!!!///////////////////////

	var time=30;

	var timer=setInterval(counterdowner, 1000); //1000 will  run it every 1 second

	function counterdowner() {

		time=time-1;
		console.log(time);
		if (time == 20) {
			$("#imageChange").attr("src", "images/yeti-content.png");
			console.log("change!");
		} else if (time == 10){
			$("#imageChange").attr("src", "images/yeti-mad.png");
		} else if (time <= 0) {

			clearInterval(timer);
			
			$("#imageChange").attr("src", "images/yeti-hungry.png");
			$("#imageChange").css("width", "80%");
			$("#imageChange").css("max-width", "350px");
			$('#header').css("height", "100vh");
			$("#countdown").css("display", "none");
			$("#map-canvas").css("display", "none");
			$("#footer").css("display", "none");

			$("#yetiChose").html("TOO LATE! YETI CHOSES:");
			$("#yetiSpeak").html(randoRest);

			var rando = Math.floor(Math.random()*(resultsArray.length));
			var randoRest = infowindow.content(resultsArray[rando]);

			var audioElement = document.createElement('audio');
			audioElement.setAttribute('src', 'bear.wav');
			audioElement.play();
		}

			document.getElementById("countdown").innerHTML=time + " secs";

			$(function() {
				$("#pick").click( function() {

					clearInterval(timer);

             		$("#imageChange").attr("src", "images/yeti-happy.png");
					$("#imageChange").css("width", "80%");
					$("#imageChange").css("max-width", "350px");
					$('#header').css("height", "100vh");
					$("#countdown").css("display", "none");
					$("#map-canvas").css("display", "none");
					$("#footer").css("display", "none");

					$("#yetiChose").html("YOU CHOSE:");
					$("#yetiSpeak").html(infowindow.content);

           		});
			});
	}

////////////SWIPING!!!!//////////////////

      $(document).on('swipeleft swiperight', function (event) {
       if(event.type == 'swiperight') {
        var prevpage = '#' + $.mobile.activePage.prev('div[data-role="page"]')[0].id;
        $.mobile.changePage(prevpage, {
         transition: 'slide',
         reverse: true,
        });
        
       }

       if(event.type == 'swipeleft') {
        var nextpage = '#' + $.mobile.activePage.next('div[data-role="page"]')[0].id;
        $.mobile.changePage(nextpage, {
         transition: 'slide',
         reverse: false,
        });
        
       }
      });



</script>

	</head>
	<body>

		<div data-role="page" id="pageone">
		    <div data-role="main" id="pageoneContent" class="ui-content">
		    	<img id="homeImage" src="images/yeti-content.png" >
		    	<h1>HUNGRY YETI</h1>
		    	<p>Pick a place to eat before the yeti picks one for you! </p>
		    	<a id="start" href="#map-page" data-transition="slide" data-inline="true" data-role="button">START!</a>
		    </div>
		</div> 

		<div data-role="page" id="map-page" data-url="map-page">
		    <div  id = "header" data-role="header" data-theme="a">
		    	<div id= "imageContainer">
			   		<img id="imageChange" src="images/yeti-happy.png">
			   	</div>
			    <h1 id = "countdown"></h1>
			    <h1 id ="yetiChose"></h1>
			    <h1 id ="yetiSpeak"></h1>
		    </div>
		    <div role="main" class="ui-content" id="map-canvas">
		     <!-- map loads here... -->
		    </div>
		    <div data-role="footer" id = "footer">
		    	<div id="buttonWrapper">
			    	<a id="pick" data-inline="true" data-icon="check" data-role="button"> PICK! </a>
			    	<a id="next" data-inline="true" data-icon="carat-r" data-role="button" > NEXT!</a>
			    </div>
		    </div>
		</div>

	</body>
</html>